<!DOCTYPE html>
<html>
  <head>
    <title>Добро пожаловать!</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
      body {
        background-color: var(--tg-theme-bg-color);
        color: var(--tg-theme-text-color);
      }
    </style>
  </head>
  <body>
    <div id="hello">Добро пожаловать!</div>
    <div id="list"></div>
    <div id="progress" style="display: none">Идет процесс записи в офис...</div>
    <div id="talon" style="display: none">
      <div>Ваш талон</div>
      <div>В 023</div>
      <div>Вас вызовут через <span id="timer"></span> сек</div>
    </div>
    <script>
      {
        let tg = window.Telegram.WebApp; //получаем объект webapp телеграма

        tg.expand(); //расширяем на все окно
        document.getElementById(
          "hello"
        ).innerText = `Добро пожаловать, ${tg.initDataUnsafe.user.first_name} ${tg.initDataUnsafe.user.last_name}!`;
        const operations = [
          "Кредиты, ипотека",
          "Платежи наличными",
          "Карты",
          "Платежи по карте",
          "Наличные, пенсии",
          "Вклады, счета",
          "Другие продукты",
        ];

        const elList = document.getElementById("list");
        const elProgress = document.getElementById("progress");
        const elTalon = document.getElementById("talon");
        const elTimer = document.getElementById("timer");

        let timeForCall = 10;
        const callTalon = () => {
            elTimer.innerText = String(elTimer);
            if (timeForCall > 0) {
                setTimeout(() => {
                    timeForCall--;
                }, 1000);
                return;
            }
            tg.offEvent('popupClosed', callTalon);
            tg.showPopup({ title: "Вас ожидают", message: "Окно 5" });
        };
        const successRecord = () => {
          elProgress.style.display = "none";
          elTalon.style.display = "";
          tg.showPopup({ title: "Ваш талон", message: "В 023" });
          tg.onEvent('popupClosed', callTalon);
        };
        const factoryHandlerSelectOperation = (operation) => () => {
          elList.style.display = "none";
          elProgress.style.display = "";
          setTimeout(successRecord, 3000);
        };
        const createButton = (operation) => {
          const elButton = document.createElement("button");
          elButton.addEventListener(
            "click",
            factoryHandlerSelectOperation(operation)
          );
          elButton.style.display = "block";
          elButton.style.marginTop = "10px";
          elButton.style.padding = "5px 20px";
          elButton.style.width = "100%";
          elButton.innerHTML = operation;
          return elButton;
        };
        const showList = () => {
          elList.style.display = "";
          if (elList.children.length > 0) {
            return;
          }
          operations.forEach((operation) => {
            elList.appendChild(createButton(operation));
          });
        };
        showList();
      }
    </script>
  </body>
</html>
